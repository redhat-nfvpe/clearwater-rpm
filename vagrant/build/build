#!/bin/bash
set -e

SPEC=${1:-*}

HERE=$(dirname "$(readlink -f "$0")")
TOPDIR="$HERE/.."
ESCAPED_TOPDIR=$(printf %q "$TOPDIR")

sudo yum install --assumeyes rpm-build epel-release
sudo yum-builddep --assumeyes "$TOPDIR/SPECS/"$SPEC.spec

rpmbuild --define "_topdir $ESCAPED_TOPDIR" -ba "$TOPDIR/SPECS/"$SPEC.spec \
	2>&1 | tee "$HERE/build.log"
